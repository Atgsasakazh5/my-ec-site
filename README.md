# ECサイト バックエンドAPI

Spring BootとMySQLで構築した、基本的な機能を持つECサイトのバックエンドAPIです。

## 概要

このプロジェクトは、実際のWebアプリケーション開発で求められる基本的ながらも重要な技術要素（認証、商品管理、在庫管理、カート、注文処理など）を網羅的に実装したECサイトのバックエンドです。

フロントエンド（Next.jsなどを想定）と連携し、ユーザーが商品を閲覧・購入できるオンラインストアの基盤を提供します。

-----

## 使用技術 💻

### バックエンド

  * **言語**: Java 21
  * **フレームワーク**: Spring Boot 3.x
  * **ビルドツール**: Maven
  * **データアクセス**: Spring JDBC (`JdbcTemplate`, `NamedParameterJdbcTemplate`)
  * **認証**: Spring Security, JWT (JSON Web Token)
  * **外部API連携**: Stripe (決済)

### データベース

  * **本番/開発**: MySQL 8.0
  * **テスト**: H2 Database

### インフラ・テスト

  * **コンテナ**: Docker, Docker Compose
  * **CI/CD**: GitHub Actions
  * **テストフレームワーク**: JUnit 5, Mockito, AssertJ

-----

## APIエンドポイント一覧 Endpoints

### 認証 (`/api/auth`)

| HTTPメソッド | URL | 説明 |
| :--- | :--- | :--- |
| `POST` | `/signup` | 新規ユーザー登録 |
| `POST` | `/login` | ログイン（JWT発行） |

### ユーザー (`/api/users`)

| HTTPメソッド | URL | 説明 |
| :--- | :--- | :--- |
| `GET` | `/me` | ログイン中のユーザー情報を取得 |

### 商品カタログ (公開用)

| HTTPメソッド | URL | 説明 |
| :--- | :--- | :--- |
| `GET` | `/api/products` | 商品一覧をページネーションで取得 |
| `GET` | `/api/products/{id}` | 特定の商品の詳細情報を取得 |
| `GET` | `/api/categories` | カテゴリ一覧を取得 |
| `GET` | `/api/categories/{id}/products` | 特定のカテゴリに属する商品一覧を取得 |

### カート (`/api/cart`)

| HTTPメソッド | URL | 説明 |
| :--- | :--- | :--- |
| `GET` | `/` | 自分のカート詳細を取得 |
| `POST` | `/items` | カートに商品を追加 |
| `PUT` | `/items/{cartItemId}` | カート内の商品数量を変更 |
| `DELETE` | `/items/{cartItemId}` | カートから商品を削除 |

### 注文 (`/api/orders`)

| HTTPメソッド | URL | 説明 |
| :--- | :--- | :--- |
| `POST` | `/` | カートの内容から注文を作成 |
| `POST` | `/payment` | 注文に対する決済を実行 |
| `GET` | `/` | 自分の注文履歴一覧を取得 |
| `GET` | `/{orderId}` | 特定の注文の詳細を取得 |

### 管理者用 (`/api/admin`)

| HTTPメソッド | URL | 説明 |
| :--- | :--- | :--- |
| `POST` | `/categories` | 新規カテゴリ作成 |
| `PUT` | `/categories/{id}` | カテゴリ情報更新 |
| `POST` | `/products` | 新規商品作成（SKU・在庫情報含む） |
| `PUT` | `/products/{id}` | 商品情報更新 |
| `POST` | `/products/{id}/skus` | 既存商品にSKUを追加 |
| `PUT` | `/skus/{skuId}` | SKU情報更新 |

-----

## 工夫した点

### 1\. 堅牢なデータアクセス層の構築

  * **JdbcTemplateの採用**:
    ORM（JPA/Hibernate）に頼らず、`JdbcTemplate`と`NamedParameterJdbcTemplate`を全面的に採用しました。これにより、発行されるSQLを完全に制御し、N+1問題のようなパフォーマンスボトルネックを意識的に回避する設計を行いました。
  * **DAOパターンの実践**:
    `RowMapper`や`KeyHolder`を活用し、データアクセスロジックをDAO層にカプセル化しました。

### 2\. 拡張性を考慮したデータベース設計

  * **SKU層の導入**:
    単なる商品管理に留まらず、サイズや色といった商品のバリエーションを管理するための`skus`テーブルを導入しました。これにより、実際のECサイトで求められる複雑な在庫・価格管理に対応できる、拡張性の高い設計を実現しました。

### 3\. パフォーマンスとセキュリティへの配慮

  * **N+1問題の対策**:
    商品一覧や注文詳細の取得において、複数の関連データを一度のクエリでまとめて取得するロジックを実装し、データベースへのアクセスを最小限に抑えました。
  * **排他ロックによる在庫引き当て**:
    注文確定時の在庫引き当て処理では、`SELECT ... FOR UPDATE`句を用いて在庫レコードをロックすることで、複数のユーザーが同時に注文した際の競合状態を防ぎ、データの整合性を保証しています。
  * **所有権の検証**:
    カートや注文情報を操作するAPIでは、リクエストされたデータが現在ログインしているユーザーのものであることを必ず検証し、他人のデータを不正に操作できないように設計しました。

### 4\. 品質を保証する徹底したテスト

  * **テスト戦略の分離**:
    `@JdbcTest`（DAO層）、`@ExtendWith(MockitoExtension.class)`（サービス層）、`@SpringBootTest`（コントローラー層）を使い分け、各層の責務に応じた適切なテストを実装しました。
  * **CI/CDパイプラインのDocker化**:
    GitHub Actions上の自動テストをDockerコンテナ（MySQL含む）で実行するように構築しました。これにより、開発環境とCI環境の差異をなくし、より信頼性の高いテストを実現しました。

-----

## 今後の課題

### 1\. 画像のアップロード機能
現在は商品登録の際に画像URLを指定する形ですが、AWS上で運用する場合は画像を直接アップロードできる機能を実装したい。

### 2\.メールマガジンの配信機能
バッチ処置の練習がてらメールマガジン配信の機能を実装したい。